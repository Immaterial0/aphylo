---
title: "aphylo: Statistical Inference of Annotated Phylogenetic Trees"
output: github_document
---

[![Travis-CI Build Status](https://travis-ci.org/USCbiostats/phylogenetic.svg?branch=master)](https://travis-ci.org/USCbiostats/phylogenetic)
[![AppVeyor Build Status](https://ci.appveyor.com/api/projects/status/github/USCbiostats/phylogenetic?branch=master&svg=true)](https://ci.appveyor.com/project/USCbiostats/phylogenetic)
[![Coverage Status](https://img.shields.io/codecov/c/github/USCbiostats/phylogenetic/master.svg)](https://codecov.io/github/USCbiostats/phylogenetic?branch=master)

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The `aphylo` R package implements estimation and data imputation methods for Functional Annotations in Phylogenetic Trees. The core function consists on the computation of the log-likelihood of observing a given phylogenetic tree with functional annotation on its leafs, and probabilities associated to gain and loss of functionalities, including probabilities of experimental misclasification. Furthermore, the log-likelihood is computed using peeling algorithms, which required us to develop efficient algorithms for recoding and preparing phylogenetic tree data so that can be used with the package. The package `aphylo` works smoothly with popular tools for analysis of phylogenetic data such as `ape`--Analyses of Phylogenetics and Evolution--which makes `aphylo`

## Install

Using devtools

```r
devtools::install_github("USCbiostats/aphylo")
```

## Reading data

```{r Loading the package}
library(aphylo)
```


```{r Reading Data}

# This datasets are included in the package
data("fakeexperiment")
data("faketree")

head(fakeexperiment)
head(faketree)
```

```{r Get offspring}
O <- new_aphylo(
  annotations = fakeexperiment, 
  leafidvar   = "LeafId",
  edges       = faketree
)

# There is no nice print method for now
as.apephylo(O)

# We can visualize it
plot(O)
plot_LogLike(O)
```

## Simulating annoated trees

```{r}
set.seed(123)
plot(sim_tree(10))
dat <- sim_annotated_tree(200, P=2)
as.apephylo(dat)
```


## Likelihood


```{r Computing likelihood}
# Parameters and data
psi     <- c(0.020,0.010)
mu      <- c(0.04,.01)
pi_root <- c(1-0.5,.5)

# Computing likelihood
with(dat, 
     LogLike(
       annotations = annotations, 
       offspring   = offspring, 
       noffspring  = noffspring, 
       psi = psi, mu = mu, Pi = pi_root)
)

```

# MLE estimation

```{r MLE}
# Using Artificial Bee Colony algorithm
ans0 <- phylo_mle(dat, method = "ABC")
ans0

# Plotting the path
plot(ans0)
```

